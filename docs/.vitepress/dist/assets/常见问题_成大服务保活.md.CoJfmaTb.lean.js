import{_ as i,c as a,a2 as n,o as h}from"./chunks/framework.CiG9Bwkw.js";const g=JSON.parse('{"title":"成大服务保活","description":"","frontmatter":{},"headers":[],"relativePath":"常见问题/成大服务保活.md","filePath":"常见问题/成大服务保活.md","lastUpdated":1721188994000}'),t={name:"常见问题/成大服务保活.md"};function l(k,s,p,e,r,E){return h(),a("div",null,s[0]||(s[0]=[n(`<h1 id="成大服务保活" tabindex="-1">成大服务保活 <a class="header-anchor" href="#成大服务保活" aria-label="Permalink to &quot;成大服务保活&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">提示</p><p>在实践过程中发现极少门店的成大服务（ChengDaService）会发生停止的情况，服务停止之后监控的闸机和厨打就不工作了，对门店运营造成困扰。我们需要对成大服务进行保活，以保证服务正常运行，设置3秒检测一次，如果服务停止了，就自动重新启动。</p></div><h2 id="一、批处理文件" tabindex="-1">一、批处理文件 <a class="header-anchor" href="#一、批处理文件" aria-label="Permalink to &quot;一、批处理文件&quot;">​</a></h2><p>可以直接点击下载<a href="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/Monitor%E4%BF%9D%E6%B4%BB.bat" target="_blank" rel="noreferrer">Monitor保活脚本</a>，也可以复制下面的脚本更改！</p><div class="language-bat vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 设置已管理员运行cmd命令</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@echo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> off</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nul</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%SYSTEMROOT%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\system32\\cacls.exe&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%SYSTEMROOT%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\system32\\config\\system&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &#39;%errorlevel%&#39; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NEQ</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &#39;0&#39; (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UACPrompt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gotAdmin )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UACPrompt</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Set UAC = CreateObject</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Shell.Application&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%temp%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UAC.ShellExecute </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%~s0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;runas&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%temp%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%temp%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /B</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">gotAdmin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> exist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%temp%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\getadmin.vbs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">del</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">%temp%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\getadmin.vbs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 定义循环间隔时间和监测的服务，这里设置为3秒</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> secs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 成大服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> srvname</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChengDaService&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ========================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ==         查询计算机服务的状态，     ==</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ==     每间隔%secs%秒种进行一次查询，     ==</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ==     发现服务其停止，立即启动。     ==</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ========================================</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 此脚本监测的服务是：%srvname%</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %srvname%. </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> . </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">chkit</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> svrst</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 使用for 循环遍历当前系统上正在运行的服务列表。判断运行的服务列表里面是否存在 %srvname% ，匹配成功，则将 svrst 的值设置为 1。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /F </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tokens=1* delims= &quot;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> %%a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (&#39;net start&#39;) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /I </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%%a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> %%b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %srvname% (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> svrst</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 查询服务状态</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 服务状态为：%svrst%</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %svrst% </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    net start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %srvname%</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 服务 %srvname% 正常启动成功了。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rem</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 下面的命令用于延时，否则可能会导致cpu单个核心满载。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -n %secs% 127.0.0.1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nul</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">goto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chkit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p><strong>注意：需要把Bat脚本文件设置为ANSI编码，否则会出现控制台中文乱码的情况。</strong></p><p>关于脚本本身的含义大家直接看脚本里面的注释就很清楚了，另外还增加了直接指定管理员命令运行Bat，这样避免直接双击运行Bat脚本而没有权限的问题。这部分脚本可以通用。大家如果编写了其他运维脚本也在首行可以加上这段，就可以实现自动以管理员身份运行。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 设置已管理员运行cmd命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> off</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nul </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">2&gt;&amp;1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%SYSTEMROOT%\\system32\\cacls.exe&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%SYSTEMROOT%\\system32\\config\\system&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> &#39;%errorlevel%&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NEQ</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UACPrompt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) else ( goto gotAdmin )</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:UACPrompt</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UAC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CreateObject^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;Shell.Application&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%temp%\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UAC.ShellExecute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%~s0&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;runas&quot;,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%temp%\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;%temp%\\getadmin.vbs&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /B</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:gotAdmin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%temp%\\getadmin.vbs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">del</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;%temp%\\getadmin.vbs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span></span></code></pre></div><h2 id="二、运行效果" tabindex="-1">二、运行效果 <a class="header-anchor" href="#二、运行效果" aria-label="Permalink to &quot;二、运行效果&quot;">​</a></h2><p>我们把成大服务停止，然后运行bat脚本。</p><p>会首先检测到服务状态为0，然后马上开始启动服务。 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717095612.png" alt="20240717095612" loading="lazy"></p><p>服务启动后，重新执行Bat脚本，效果如下图 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717095833.png" alt="20240717095833" loading="lazy"></p><h2 id="三、封装为服务的方式运行" tabindex="-1">三、封装为服务的方式运行 <a class="header-anchor" href="#三、封装为服务的方式运行" aria-label="Permalink to &quot;三、封装为服务的方式运行&quot;">​</a></h2><p>建议把Bat脚本打包为Windows服务器的方式运行，如果直接使用cmd窗口运行的话，有被关掉的风险，使用后台运行的方式更加可靠。这里提供一种方式：</p><h3 id="开源的java工具winsw" tabindex="-1">开源的Java工具winsw <a class="header-anchor" href="#开源的java工具winsw" aria-label="Permalink to &quot;开源的Java工具winsw&quot;">​</a></h3><p>使用它可以将任何可执行文件包装成Windows服务。你需要编写一个XML配置文件来指定批处理文件的位置和其他参数，然后用winsw.exe和配置文件一起创建服务。 下载地址：<a href="https://github.com/kohsuke/winsw/releases" target="_blank" rel="noreferrer">https://github.com/kohsuke/winsw/releases</a></p><ol><li>这里的话我已经把相关配置修改好了，可以直接下载运行，有兴趣的可以去上面的地址去研究一下。 点击直接下载我已经配置好的<a href="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%B4%BB.zip" target="_blank" rel="noreferrer">服务保活</a>文件，解压到D盘，里面包含两个文件： <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717100303.png" alt="20240717100303" loading="lazy"></li></ol><p>其中xml文件里面有个文件路径，如果上面的bat文件跟文件里面的路径不一样，你需要修改一下。 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717100510.png" alt="20240717100510" loading="lazy"></p><ol start="2"><li>安装服务 在cmd命令提示符中执行一下命令：</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">服务保活.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><p>执行的时候要在程序所在文件夹的路径执行，一般需要先切换目录 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717114102.png" alt="20240717114102" loading="lazy"></p><p>Win11的powershell里面需要在前面添加 .\\ 符号 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717113757.png" alt="20240717113757" loading="lazy"> 安装成功打开服务管理Win+R，输入：services.msc，找到你的服务，说明服务已经安装了,记得把服务启动。 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717113730.png" alt="20240717113730" loading="lazy"></p><ol start="3"><li>服务本身的保活</li></ol><p><img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717115256.png" alt="20240717115256" loading="lazy"></p><ol start="4"><li><p>保活日志</p><p>在保活服务文件夹内可以看到记录的日志 <img src="https://wiki-cdsoft.oss-cn-hangzhou.aliyuncs.com/20240717115507.png" alt="20240717115507" loading="lazy"></p></li></ol>`,25)]))}const F=i(t,[["render",l]]);export{g as __pageData,F as default};
